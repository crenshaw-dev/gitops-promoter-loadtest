
========================================
Promoter Load Test Setup
========================================
[INFO] Number of assets: 1
[INFO] Asset GitHub Organization: crenshaw-dev
[INFO] Asset GitHub URL: https://github.com
[INFO] Load Test Repository: https://github.com/crenshaw-dev/gitops-promoter-loadtest
[INFO] Promoter Cluster: https://kubernetes.default.svc
[INFO] Argo CD Cluster: https://kubernetes.default.svc
[INFO] Destination Cluster: https://kubernetes.default.svc
[INFO] Run directory: runs/2025-10-04-15-46-41
[INFO] Manifests directory: runs/2025-10-04-15-46-41/manifests
[INFO] Log file: runs/2025-10-04-15-46-41/logs/setup.log

========================================
Validated Prerequisites
========================================
[INFO] ✓ Configuration loaded from config.sh
[INFO] ✓ gh (GitHub CLI) found and authenticated
[INFO] ✓ kubectl found
[INFO] ✓ jq found
[INFO] Copying test results template
[INFO] Results file created: runs/2025-10-04-15-46-41/README.md

========================================
Detecting GitHub Account Type
========================================
[INFO] Auto-detecting account type for crenshaw-dev...
[INFO] Detected as user account

========================================
GitHub App Configuration
========================================
[INFO] Using GitHub App configuration from config.sh:
  → App Name: promoter-test-2025-10-04-14-52-33
  → App ID: 2063184
  → Key Path: /Users/mcrenshaw/Downloads/promoter-test-2025-10-04-14-52-33.2025-10-04.private-key.pem

========================================
Creating GitHub Repositories
========================================
[INFO] This will create 1 repositories (deployment only, config repos disabled)
[INFO] Account type: user
[STEP] Creating repositories for asset 0000
  → Creating promoter-test-0000-deployment
[WARN]   Repository crenshaw-dev/promoter-test-0000-deployment already exists, reusing it
  → Setting up promoter-test-0000-deployment
[WARN]   Repository already has content, pulling latest
Already up to date.
  →   Using default templates from repo-templates/asset-deployment
[main 80290df] Update deployment configuration for asset 0000
 1 file changed, 1 insertion(+), 1 deletion(-)
  →   Pushing to main
To https://github.com/crenshaw-dev/promoter-test-0000-deployment.git
   619dd06..80290df  HEAD -> main
[INFO]   ✓ Initialized repositories for asset 0000
[INFO] All repositories created and initialized
[INFO] Using configured GitHub App Installation ID: 88716042

========================================
Generating Kubernetes Manifests
========================================
[STEP] Generating promoter cluster manifests
[INFO] Generated promoter cluster manifests: runs/2025-10-04-15-46-41/manifests/promoter/all-resources.yaml
[STEP] Generating Argo CD cluster manifests
[INFO] Generated Argo CD cluster manifests: runs/2025-10-04-15-46-41/manifests/argocd/all-resources.yaml
[STEP] Generating destination cluster manifests
[INFO] Generated destination cluster manifests: runs/2025-10-04-15-46-41/manifests/destination/all-resources.yaml

========================================
Setup Summary
========================================
[INFO] Setup summary saved to runs/2025-10-04-15-46-41/logs/SETUP_SUMMARY.md

========================================
Setup Complete!
========================================

[INFO] Generated manifests for:
  • 2 GitHub repositories
  • 1 GitRepository resources
  • 1 PromotionStrategy resources
  • 1 ArgoCDCommitStatus resources
  • 6 Argo CD Applications
  • 7 Kubernetes Namespaces


========================================
Applying Kubernetes Manifests
========================================

[INFO] Now applying manifests to your clusters...

[STEP] Applying manifests to PROMOTER cluster...
secret/promoter-github-app-2025-10-04-15-46-41 created
clusterscmprovider.promoter.argoproj.io/promoter-test-2025-10-04-15-46-41 created
Error from server (AlreadyExists): error when creating "runs/2025-10-04-15-46-41/manifests/promoter/all-resources.yaml": namespaces "promoter-test-0000" already exists
Error from server (AlreadyExists): error when creating "runs/2025-10-04-15-46-41/manifests/promoter/all-resources.yaml": gitrepositories.promoter.argoproj.io "promoter-test-0000" already exists
Error from server (AlreadyExists): error when creating "runs/2025-10-04-15-46-41/manifests/promoter/all-resources.yaml": promotionstrategies.promoter.argoproj.io "promoter-test-0000" already exists
Error from server (AlreadyExists): error when creating "runs/2025-10-04-15-46-41/manifests/promoter/all-resources.yaml": argocdcommitstatuses.promoter.argoproj.io "promoter-test-0000" already exists
[ERROR] ✗ Failed to create promoter resources. They may already exist.

Would you like to run cleanup and try again? (Y/n) 
[WARN] Running cleanup...
secret "promoter-github-app-2025-10-04-15-46-41" deleted
clusterscmprovider.promoter.argoproj.io "promoter-test-2025-10-04-15-46-41" deleted
namespace "promoter-test-0000" deleted
gitrepository.promoter.argoproj.io "promoter-test-0000" deleted
promotionstrategy.promoter.argoproj.io "promoter-test-0000" deleted
argocdcommitstatus.promoter.argoproj.io "promoter-test-0000" deleted
appproject.argoproj.io "promoter-loadtest" deleted
application.argoproj.io "promoter-loadtest" deleted
appproject.argoproj.io "promoter-test-0000" deleted
secret "promoter-test-0000-repo-write-creds" deleted
application.argoproj.io "promoter-test-0000-dev-use2" deleted
application.argoproj.io "promoter-test-0000-dev-usw2" deleted
application.argoproj.io "promoter-test-0000-stg-use2" deleted
application.argoproj.io "promoter-test-0000-stg-usw2" deleted
application.argoproj.io "promoter-test-0000-prd-use2" deleted
application.argoproj.io "promoter-test-0000-prd-usw2" deleted
namespace "promoter-test-0000-dev-use2" deleted
namespace "promoter-test-0000-dev-usw2" deleted
namespace "promoter-test-0000-stg-use2" deleted
namespace "promoter-test-0000-stg-usw2" deleted
namespace "promoter-test-0000-prd-use2" deleted
namespace "promoter-test-0000-prd-usw2" deleted
[INFO] Cleanup complete. Retrying...

[STEP] Applying manifests to PROMOTER cluster (retry)...
secret/promoter-github-app-2025-10-04-15-46-41 created
clusterscmprovider.promoter.argoproj.io/promoter-test-2025-10-04-15-46-41 created
namespace/promoter-test-0000 created
gitrepository.promoter.argoproj.io/promoter-test-0000 created
promotionstrategy.promoter.argoproj.io/promoter-test-0000 created
argocdcommitstatus.promoter.argoproj.io/promoter-test-0000 created
[INFO] ✓ Promoter cluster resources created successfully

[STEP] Patching promoter GitHub App secret with private key...
Warning: resource secrets/promoter-github-app-2025-10-04-15-46-41 is missing the kubectl.kubernetes.io/last-applied-configuration annotation which is required by kubectl apply. kubectl apply should only be used on resources created declaratively by either kubectl create --save-config or kubectl apply. The missing annotation will be patched automatically.
secret/promoter-github-app-2025-10-04-15-46-41 configured
[INFO] ✓ Promoter secret patched successfully

[STEP] Applying manifests to ARGO CD cluster...
appproject.argoproj.io/promoter-loadtest created
application.argoproj.io/promoter-loadtest created
appproject.argoproj.io/promoter-test-0000 created
secret/promoter-test-0000-repo-write-creds created
application.argoproj.io/promoter-test-0000-dev-use2 created
application.argoproj.io/promoter-test-0000-dev-usw2 created
application.argoproj.io/promoter-test-0000-stg-use2 created
application.argoproj.io/promoter-test-0000-stg-usw2 created
application.argoproj.io/promoter-test-0000-prd-use2 created
application.argoproj.io/promoter-test-0000-prd-usw2 created
[INFO] ✓ Argo CD cluster resources created successfully

[STEP] Patching Argo CD repo-write-creds secrets with private key...
Warning: resource secrets/promoter-test-0000-repo-write-creds is missing the kubectl.kubernetes.io/last-applied-configuration annotation which is required by kubectl apply. kubectl apply should only be used on resources created declaratively by either kubectl create --save-config or kubectl